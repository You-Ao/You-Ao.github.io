import{f as W,u as N,g as X,h as Z,j as ee,t as se,i as ae,k as S,l as H,m as e,n as le,w as te,s as re,R as $,p as ie,q as ue,v as oe,x as ce,y as ne,z as E,A as F,B as he,C as ve,D as de,E as me,L as pe,F as ye,G as ge,H as Le,I as V,J as fe,K as A}from"./app-9ID7W3jY.js";const Ce=["/","/AI/","/AI/math.html","/Iap/","/Others/","/srtp/","/srtp/pg-agent.html","/AI/CV/Lecture_2.html","/AI/CV/Lecture_3.html","/AI/CV/Lecture_5.html","/AI/CV/Lecture_7.html","/AI/CV/Lecture_8.html","/AI/CV/","/AI/ML/Chapter_1.html","/AI/ML/Chapter_10.html","/AI/ML/Chapter_3.html","/AI/ML/Chapter_4.html","/AI/ML/Chapter_7.html","/AI/ML/Chapter_8.html","/AI/ML/","/Iap/mao/","/Iap/mao/review.html","/Others/Music/Lesson1.html","/Others/Music/Lesson2.html","/Others/Music/Lesson7.html","/Others/Music/","/404.html"],Ie="SLIMSEARCH_QUERY_HISTORY",g=V(Ie,[]),He=()=>{const{queryHistoryCount:t}=A;return{enabled:t>0,queryHistories:g,addQueryHistory:o=>{g.value=Array.from(new Set([o,...g.value.slice(0,t-1)]))},removeQueryHistory:o=>{g.value=[...g.value.slice(0,o),...g.value.slice(o+1)]}}},q=t=>Ce[t.id]+("anchor"in t?`#${t.anchor}`:""),Ae="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:O}=A,L=V(Ae,[]),ke=()=>({enabled:O>0,resultHistories:L,addResultHistory:u=>{{const o={link:q(u),display:u.display};"header"in u&&(o.header=u.header),L.value=[o,...L.value.slice(0,O-1)]}},removeResultHistory:u=>{L.value=[...L.value.slice(0,u),...L.value.slice(u+1)]}}),we=t=>{const{page:u,routeLocale:o}=he(),k=ve(),r=S(0),f=H(()=>r.value>0),h=de([]);return me(()=>{const{search:w,terminate:m}=pe(),C=ge(p=>{const{resultsFilter:x=l=>l,querySplitter:y,suggestionsFilter:M,...i}=k.value;p?(r.value+=1,w(p,o.value,i).then(l=>x(l,p,o.value,u.value)).then(l=>{r.value-=1,h.value=l}).catch(l=>{console.warn(l),r.value-=1,r.value||(h.value=[])})):h.value=[]},A.searchDelay-A.suggestDelay,{maxWait:5e3});ye([t,o],([p])=>C(p.join(" "))),Le(()=>{m()})}),{isSearching:f,results:h}};var Re=W({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(t,{emit:u}){const o=N(),k=X(),r=Z(ee),{addQueryHistory:f,queryHistories:h,removeQueryHistory:w}=He(),{resultHistories:m,addResultHistory:C,removeResultHistory:p}=ke(),x=se(t,"queries"),{results:y,isSearching:M}=we(x),i=ae({isQuery:!0,index:0}),l=S(0),v=S(0),_=H(()=>h.value.length>0||m.value.length>0),R=H(()=>y.value.length>0),Q=H(()=>y.value[l.value]||null),T=()=>{const{isQuery:s,index:a}=i;a===0?(i.isQuery=!s,i.index=s?m.value.length-1:h.value.length-1):i.index=a-1},j=()=>{const{isQuery:s,index:a}=i;a===(s?h.value.length-1:m.value.length-1)?(i.isQuery=!s,i.index=0):i.index=a+1},U=()=>{l.value=l.value>0?l.value-1:y.value.length-1,v.value=Q.value.contents.length-1},P=()=>{l.value=l.value<y.value.length-1?l.value+1:0,v.value=0},Y=()=>{v.value<Q.value.contents.length-1?v.value+=1:P()},B=()=>{v.value>0?v.value-=1:U()},b=s=>s.map(a=>fe(a)?a:e(a[0],a[1])),z=s=>{if(s.type==="customField"){const a=ce[s.index]||"$content",[d,c=""]=ne(a)?a[k.value].split("$content"):a.split("$content");return s.display.map(n=>e("div",b([d,...n,c])))}return s.display.map(a=>e("div",b(a)))},I=()=>{l.value=0,v.value=0,u("updateQuery",""),u("close")},G=()=>e("div",{class:"slimsearch-records"},e("div",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.queryHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},h.value.map((s,a)=>{const d=i.isQuery&&i.index===a;return e("li",{class:["slimsearch-record-matches",{active:d}],role:"option","aria-selected":d,onClick:()=>{u("updateQuery",s)}},e("div",[e(E,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},s),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:F,onClick:c=>{c.preventDefault(),c.stopPropagation(),w(a)}})]))}))])),J=()=>e("ul",{class:"slimsearch-records"},e("li",{class:"slimsearch-record"},[e("div",{class:"slimsearch-record-title"},r.value.resultHistory),e("ul",{class:"slimsearch-record-contents",role:"listbox"},m.value.map((s,a)=>{const d=!i.isQuery&&i.index===a;return e("li",{class:["slimsearch-record-matches",{active:d}],role:"option","aria-selected":d},e($,{to:s.link,onClick:()=>{I()}},()=>[e(E,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[s.header?e("div",{class:"slimsearch-record-content-header"},s.header):null,e("div",s.display.map(c=>b(c)).flat())]),e("button",{type:"button",class:"slimsearch-remove-icon",title:r.value.remove,"aria-label":r.value.remove,innerHTML:F,onClick:c=>{c.preventDefault(),c.stopPropagation(),p(a)}})]))}))]));return le("keydown",s=>{if(t.isFocusing){if(R.value){if(s.key==="ArrowUp")B();else if(s.key==="ArrowDown")Y();else if(s.key==="Enter"){const a=Q.value.contents[v.value];f(t.queries.join(" ")),C(a),o.push(q(a)),I()}}else if(s.key==="ArrowUp")T();else if(s.key==="ArrowDown")j();else if(s.key==="Enter"){const{index:a}=i;i.isQuery?(s.preventDefault(),u("updateQuery",h.value[a])):(o.push(m.value[a].link),I())}}}),te([l,v],()=>{document.querySelector(".slimsearch-record.active .slimsearch-record-matches.active")?.scrollIntoView(!1)},{flush:"post"}),()=>e("div",{id:"slimsearch-results",class:["slimsearch-result-wrapper",{empty:t.queries.length?!R.value:!_.value}]},t.queries.length?M.value?e(re,{hint:r.value.searching}):R.value?e("div",{class:"slimsearch-records",role:"listbox","aria-labeledby":"slimsearch-label"},y.value.map(({title:s,contents:a},d)=>{const c=l.value===d;return e("div",{class:["slimsearch-record",{active:c}],role:"group","aria-selected":c},[e("div",{class:"slimsearch-record-title"},s||r.value.defaultTitle),e("ul",{class:"slimsearch-record-contents"},a.map((n,K)=>{const D=c&&v.value===K;return e("li",{class:["slimsearch-record-matches",{active:D}],role:"option","aria-selected":D},e($,{to:q(n),onClick:()=>{f(t.queries.join(" ")),C(n),I()}},()=>[n.type==="text"?null:e(n.type==="title"?ie:n.type==="heading"?ue:oe,{class:"slimsearch-record-type"}),e("div",{class:"slimsearch-record-content"},[n.type==="text"&&n.header?e("div",{class:"slimsearch-record-content-header"},n.header):null,e("div",z(n))])]))}))])})):r.value.emptyResult:_.value?[G(),J()]:r.value.emptyHistory)}});export{Re as default};
